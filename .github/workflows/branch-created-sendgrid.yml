name: Notify on Branch Creation (SendGrid via Curl)

# Trigger when a branch or tag is created
on:
  create: {}

jobs:
  branch-created:
    # Only run for branches, not tags
    if: ${{ github.event.ref_type == 'branch' }}
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout repository (optional, good practice)
      - name: Checkout repository
        uses: actions/checkout@v3

      # Step 2: Send email via SendGrid API
      - name: Send email via SendGrid API
        run: |
          curl -s --request POST \
            --url https://api.sendgrid.com/v3/mail/send \
            --header "Authorization: Bearer ${{ secrets.SENDGRID_API_KEY }}" \
            --header 'Content-Type: application/json' \
            --data '{
              "personalizations": [{"to": [{"email": "'"${{ secrets.EMAIL_TO }}"'"}]}],
              "from": {"email": "'"${{ secrets.EMAIL_FROM }}"'"},
              "subject": "New branch created: '"${GITHUB_REF#refs/heads/}"'",
              "content": [{"type": "text/plain", "value": "Repository: '"${GITHUB_REPOSITORY}"'\nBranch: '"${GITHUB_REF#refs/heads/}"'\nCreated by: '"${GITHUB_ACTOR}"'\nLink: https://github.com/'"${GITHUB_REPOSITORY}"'/tree/'"${GITHUB_REF#refs/heads/}"'"}]
            }'
