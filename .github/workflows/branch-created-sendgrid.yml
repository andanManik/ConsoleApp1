name: Notify on Branch Creation (SendGrid)

# Trigger when a branch or tag is created
on:
  create: {}

jobs:
  branch-created:
    # Only run for branches, not tags
    if: ${{ github.event.ref_type == 'branch' }}
    runs-on: ubuntu-latest

    steps:
      # Step 1: Optional checkout (not required for this workflow, but good practice)
      - name: Checkout repository
        uses: actions/checkout@v3

      # Step 2: Compose email body variables
      - name: Set branch info
        id: info
        run: |
          echo "BRANCH_NAME=${GITHUB_REF#refs/heads/}" >> $GITHUB_OUTPUT
          echo "REPO_NAME=${GITHUB_REPOSITORY}" >> $GITHUB_OUTPUT
          echo "CREATOR=${GITHUB_ACTOR}" >> $GITHUB_OUTPUT

      # Step 3: Send email using SendGrid
      - name: Send Email via SendGrid
        uses: perfecteki/sendgrid-action@v1
        with:
          api-key: ${{ secrets.SENDGRID_API_KEY }}
          from: ${{ secrets.EMAIL_FROM }}
          to: ${{ secrets.EMAIL_TO }}
          subject: "New Branch Created: ${{ steps.info.outputs.BRANCH_NAME }}"
          content: |
            Repository: ${{ steps.info.outputs.REPO_NAME }}
            Branch: ${{ steps.info.outputs.BRANCH_NAME }}
            Created by: ${{ steps.info.outputs.CREATOR }}
            Link: https://github.com/${{ steps.info.outputs.REPO_NAME }}/tree/${{ steps.info.outputs.BRANCH_NAME }}
