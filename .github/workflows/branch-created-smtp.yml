name: Notify on branch creation (SMTP)

on:
  create: {}

jobs:
  branch-created:
    # run only when a branch (not tag) is created
    if: ${{ github.event.ref_type == 'branch' }}
    runs-on: ubuntu-latest
    steps:
      - name: Compose branch info
        id: info
        run: |
          echo "BRANCH_NAME=${GITHUB_REF#refs/heads/}" >> $GITHUB_OUTPUT
          echo "REPO=${GITHUB_REPOSITORY}" >> $GITHUB_OUTPUT
          echo "CREATOR=${{ github.actor }}" >> $GITHUB_OUTPUT

      - name: Send email via SMTP action
        uses: AlexisMateo/sendmail-action@v5    # marketplace SMTP action
        with:
          smtp-server: ${{ secrets.SMTP_SERVER }}
          smtp-server-port: ${{ secrets.SMTP_PORT }}
          auth-user: ${{ secrets.SMTP_USER }}
          auth-password: ${{ secrets.SMTP_PASSWORD }}
          subject: "New branch created: ${{ github.event.ref }}"
          body: |
            Repository: ${{ github.repository }}
            Branch: ${{ github.event.ref }}
            Created by: ${{ github.actor }}
            Link: https://github.com/${{ github.repository }}/tree/${{ github.event.ref }}
          from: ${{ secrets.EMAIL_FROM }}
          to: ${{ secrets.EMAIL_TO }}
          is-tls: true
